<!-- Main Container -->
<div class="bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden" #tableContainer>
  <!-- Header Section -->
  <div class="px-6 py-4 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white">
    <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
      <!-- Title and Stats -->
      <div>
        <h2 class="text-xl font-semibold text-gray-800">{{ name }}</h2>
      </div>

      <!-- Actions Toolbar -->
      <div class="flex flex-wrap items-center gap-2">
        <!-- Search -->
        <div class="relative">
          <input
            type="text"
            placeholder="Search..."
            class="pl-10 pr-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            (input)="handleFilter('global', $any($event.target).value)"
          />
          <svg
            class="w-5 h-5 absolute left-3 top-2.5 text-gray-400"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"
            />
          </svg>
        </div>

        <!-- Filter Toggle -->
        <button
          (click)="showFilters = !showFilters"
          class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2"
        >
          <svg class="w-5 h-5 text-gray-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M3 4a1 1 0 011-1h16a1 1 0 011 1v2.586a1 1 0 01-.293.707l-6.414 6.414a1 1 0 00-.293.707V17l-4 4v-6.586a1 1 0 00-.293-.707L3.293 7.293A1 1 0 013 6.586V4z"
            />
          </svg>
          <span class="hidden md:inline">Filters</span>
        </button>

        <!-- Export -->
        <div class="relative group">
          <button
            class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 flex items-center gap-2"
          >
            <svg
              class="w-5 h-5 text-gray-600"
              fill="none"
              stroke="currentColor"
              viewBox="0 0 24 24"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"
              />
            </svg>
            <span class="hidden md:inline">Export</span>
          </button>

          <div
            class="absolute right-0 mt-2 w-48 bg-white rounded-md shadow-lg z-10 hidden group-hover:block"
          >
            <div class="py-1">
              <button
                (click)="export('csv')"
                class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
              >
                Export as CSV
              </button>
              <button
                (click)="export('excel')"
                class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
              >
                Export as Excel
              </button>
              <button
                (click)="export('pdf')"
                class="block w-full text-left px-4 py-2 text-sm text-gray-700 hover:bg-gray-100"
              >
                Export as PDF
              </button>
            </div>
          </div>
        </div>

        <!-- Add New -->
        @if (config.onAdd) {
          <button
            (click)="addNew()"
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 flex items-center gap-2"
          >
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                stroke-width="2"
                d="M12 4v16m8-8H4"
              />
            </svg>
            <span class="hidden md:inline">Add New</span>
          </button>
        }

        <!-- Refresh -->
        <button
          (click)="refresh()"
          [disabled]="loading"
          class="px-3 py-2 border border-gray-300 rounded-lg hover:bg-gray-50 disabled:opacity-50"
        >
          <svg
            class="w-5 h-5 text-gray-600"
            [class.animate-spin]="loading"
            fill="none"
            stroke="currentColor"
            viewBox="0 0 24 24"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"
            />
          </svg>
        </button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  @if (loading) {
    <div class="p-8 text-center">
      <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
      <p class="mt-2 text-gray-600">Loading data...</p>
    </div>
  }

  <!-- Error -->
  @if (error && !loading) {
    <div class="p-8 text-center">
      <p class="text-red-600">{{ error }}</p>
      <button
        (click)="refresh()"
        class="mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700"
      >
        Retry
      </button>
    </div>
  }

  <!-- Empty -->
  @if (!loading && !error && data.length === 0) {
    <div class="p-8 text-center">
      <h3 class="text-lg font-medium text-gray-900">
        {{ config.emptyMessage || 'No data available' }}
      </h3>
    </div>
  }

  <!-- Table -->
  @if (!loading && !error && data.length > 0) {
    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            @if (config.selectable && config.showCheckboxes) {
              <th class="px-4 py-3">
                <input
                  type="checkbox"
                  [checked]="selectAll"
                  (change)="handleSelectAll()"
                  class="h-4 w-4 text-blue-600 border-gray-300 rounded"
                />
              </th>
            }

            @for (column of visibleColumns; track column.key) {
              <th
                [class]="getHeaderClasses(column)"
                (click)="
                  column.sortable &&
                    handleSort({
                      field: column.key,
                      order: currentSort?.direction === 'asc' ? -1 : 1,
                    })
                "
              >
                {{ column.label }}
              </th>
            }
            @if (config.rowActions) {
              <th class="px-4 py-3 text-right">Actions</th>
            }
          </tr>
        </thead>

        <tbody class="bg-white divide-y divide-gray-200">
          @for (row of data; track row; let i = $index) {
            <tr [class]="getRowClass(row)" (click)="config.onRowClick && handleRowClick(row)">
              @if (config.selectable && config.showCheckboxes) {
                <td class="px-2 py-1 text-center">
                  <input
                    type="checkbox"
                    [checked]="isRowSelected(row)"
                    (change)="toggleRowSelection(row)"
                    (click)="$event.stopPropagation()"
                    class="h-4 w-4 text-blue-600 border-gray-300 rounded"
                  />
                </td>
              }

              @for (column of visibleColumns; track column.key) {
                <td [class]="getCellClasses(column)">
                  {{ getCellValue(row, column) }}
                </td>
              }
              @if (config?.rowActions) {
                <td class="px-4 py-3 whitespace-nowrap text-right text-sm font-medium relative">
                  <!-- Three-dot button -->
                  <button
                    (click)="toggleRowActions(row); $event.stopPropagation()"
                    class="p-1 text-gray-500 hover:text-gray-700 rounded-full focus:outline-none"
                  >
                    <svg class="w-5 h-5" fill="currentColor" viewBox="0 0 20 20">
                      <path
                        d="M6 10a2 2 0 11-4 0 2 2 0 014 0zm6 0a2 2 0 11-4 0 2 2 0 014 0zm6 0a2 2 0 11-4 0 2 2 0 014 0z"
                      />
                    </svg>
                  </button>
                  @if (isRowActionsOpen(row)) {
                    <div
                      class="absolute right-0 mt-2 w-40 bg-white border border-gray-200 rounded-lg shadow-lg z-20 flex flex-col"
                    >
                      @for (action of config.rowActions; track action.label) {
                        <button
                          (click)="
                            action.action(row); $event.stopPropagation(); toggleRowActions(row)
                          "
                          class="px-4 py-2 text-sm text-gray-700 hover:bg-gray-100 flex items-center gap-2"
                          [ngClass]="{
                            'text-red-600': action.color === 'danger',
                            'text-blue-600': action.color === 'primary',
                          }"
                        >
                          @if (action.icon) {
                            <i class="fa {{ action.icon }}"></i>
                          }

                          {{ action.label }}
                        </button>
                      }
                    </div>
                  }
                  <!-- Actions dropdown -->
                </td>
              }
            </tr>
          }
        </tbody>
      </table>
    </div>
    <div class="px-6 py-4 border-t border-gray-200 bg-gray-50 flex items-center justify-between">
      <p-paginator
        [first]="(currentPage - 1) * pageSize"
        [rows]="pageSize"
        [totalRecords]="totalRecords"
        [rowsPerPageOptions]="[5, 10, 20, 50]"
        (onPageChange)="handlePageChange($event)"
      >
      </p-paginator>
    </div>
  }
</div>
